<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Fake Swing Ball in MR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <a-scene
      xr-mode="immersive-ar"
      renderer="alpha: true"
      environment="enabled: false"
      webxr="requiredFeatures: local-floor; optionalFeatures: hand-tracking"
      style="background-color: transparent;"
      background="transparent: true"
    >
      <!-- Red ball -->
      <a-sphere
        id="ball"
        radius="0.15"
        color="red"
        position="0 1.4 -1"
        swing-ball
      ></a-sphere>

      <!-- Hands -->
      <a-entity id="leftHand" hand-controls="hand: left"></a-entity>
      <a-entity id="rightHand" hand-controls="hand: right"></a-entity>
    </a-scene>

    <script>
      AFRAME.registerComponent("swing-ball", {
        schema: {},
        init: function () {
          this.ball = this.el;
          this.left = document.querySelector("#leftHand");
          this.right = document.querySelector("#rightHand");
          this.velocity = new THREE.Vector3();
          this.origin = this.ball.object3D.position.clone();
        },
        tick: function (time, deltaTime) {
          const dt = deltaTime / 1000;

          [this.left, this.right].forEach((hand) => {
            const handPos = hand.object3D.position;
            const ballPos = this.ball.object3D.position;
            const distance = handPos.distanceTo(ballPos);

            if (distance < 0.25) {
              const dir = new THREE.Vector3()
                .subVectors(ballPos, handPos)
                .normalize()
                .multiplyScalar(0.5); // impulse strength
              this.velocity.add(dir);
            }
          });

          // Apply velocity to ball position
          this.ball.object3D.position.addScaledVector(this.velocity, dt);

          // Return to origin gradually
          const toOrigin = new THREE.Vector3()
            .subVectors(this.origin, this.ball.object3D.position)
            .multiplyScalar(0.5 * dt);
          this.velocity.add(toOrigin);

          // Damping
          this.velocity.multiplyScalar(0.95);
        },
      });
    </script>
  </body>
</html>
