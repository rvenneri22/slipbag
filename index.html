<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>MR Fake Swing Ball</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  </head>
  <body>
    <a-scene
      renderer="alpha: true"
      xr-mode="immersive-ar"
      environment="enabled: false"
      webxr="requiredFeatures: local-floor; optionalFeatures: hand-tracking"
      style="background-color: transparent"
    >

      <!-- Ball -->
      <a-sphere
        id="ball"
        radius="0.15"
        color="red"
        position="0 1.5 -1"
      ></a-sphere>

      <!-- Hands -->
      <a-entity id="leftHand" hand-controls="hand: left"></a-entity>
      <a-entity id="rightHand" hand-controls="hand: right"></a-entity>

      <!-- Fake "swing" animation -->
      <a-animation id="swingAnim"
        attribute="position"
        to="0 1.5 -1"
        dur="300"
        easing="ease-out"
        fill="forwards"
        begin="swing"
      ></a-animation>
    </a-scene>

    <script>
      AFRAME.registerComponent('fake-swing', {
        init: function () {
          const ball = document.querySelector('#ball');
          const left = document.querySelector('#leftHand');
          const right = document.querySelector('#rightHand');
          const anim = document.querySelector('#swingAnim');

          this.el.sceneEl.addEventListener('loaded', () => {
            this.tick = () => {
              [left, right].forEach(hand => {
                const handPos = hand.object3D.position;
                const ballPos = ball.object3D.position;
                const dist = handPos.distanceTo(ballPos);

                if (dist < 0.25) {
                  // Apply fake impulse
                  const offsetX = (Math.random() - 0.5) * 0.3;
                  const offsetY = 0.1;
                  const offsetZ = (Math.random() - 0.5) * 0.3;
                  const newPos = {
                    x: ballPos.x + offsetX,
                    y: ballPos.y + offsetY,
                    z: ballPos.z + offsetZ,
                  };

                  ball.setAttribute('animation__swing', {
                    property: 'position',
                    to: `${newPos.x} ${newPos.y} ${newPos.z}`,
                    dur: 300,
                    easing: 'easeOutQuad',
                    autoplay: true,
                  });

                  // Return to center after swing
                  setTimeout(() => {
                    ball.setAttribute('animation__return', {
                      property: 'position',
                      to: `0 1.5 -1`,
                      dur: 400,
                      easing: 'easeOutElastic',
                      autoplay: true,
                    });
                  }, 300);
                }
              });
            };
          });
        }
      });

      document.querySelector('a-scene').setAttribute('fake-swing', '');
    </script>
  </body>
</html>
